<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="833px" preserveAspectRatio="none" style="width:860px;height:833px;background:#FFFFFF;" version="1.1" viewBox="0 0 860 833" width="860px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="744" x="54" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="734" x="59" y="27.9951">Hardware Layer Sequence Diagram - ESP32 &amp; MAX30102 (Asynchronous Dual Measurement)</text><rect fill="none" height="401.5938" style="stroke:#000000;stroke-width:1.5;" width="833" x="10" y="292.3906"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="49" x2="49" y1="73.5938" y2="798.3828"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="500" x2="500" y1="73.5938" y2="798.3828"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="762" x2="762" y1="73.5938" y2="798.3828"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="59" x="20" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="27" y="62.292">ESP32</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="59" x="20" y="797.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="27" y="817.3779">ESP32</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89" x="456" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="463" y="62.292">MAX30102</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89" x="456" y="797.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="463" y="817.3779">MAX30102</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141" x="692" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="699" y="62.292">Interrupt Line (INT)</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="141" x="692" y="797.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="699" y="817.3779">Interrupt Line (INT)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="853" x="0" y="104.1602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="853" y1="104.1602" y2="104.1602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="853" y1="107.1602" y2="107.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="158" x="347.5" y="93.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="353.5" y="109.6606">Initialization Phase</text><polygon fill="#181818" points="488.5,143.8594,498.5,147.8594,488.5,151.8594,492.5,147.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="49.5" x2="494.5" y1="147.8594" y2="147.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="56.5" y="142.7935">Power ON &amp; Initialize I2C</text><polygon fill="#181818" points="488.5,188.125,498.5,192.125,488.5,196.125,492.5,192.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="49.5" x2="494.5" y1="192.125" y2="192.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="56.5" y="171.9263">Configure registers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="427" x="56.5" y="187.0591">(set mode = SpO2 + HR, LED currents, sample rate, FIFO settings)</text><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="542.5" y1="221.2578" y2="221.2578"/><line style="stroke:#181818;stroke-width:1.0;" x1="542.5" x2="542.5" y1="221.2578" y2="234.2578"/><line style="stroke:#181818;stroke-width:1.0;" x1="501.5" x2="542.5" y1="234.2578" y2="234.2578"/><polygon fill="#181818" points="511.5,230.2578,501.5,234.2578,511.5,238.2578,507.5,234.2578" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="507.5" y="216.1919">Start internal sampling timer</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="853" x="0" y="262.8242"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="853" y1="262.8242" y2="262.8242"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="853" y1="265.8242" y2="265.8242"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="268" x="292.5" y="252.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="249" x="298.5" y="268.3247">Asynchronous Measurement Loop</text><path d="M10,292.3906 L87,292.3906 L87,299.5234 L77,309.5234 L10,309.5234 L10,292.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="401.5938" style="stroke:#000000;stroke-width:1.5;" width="833" x="10" y="292.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="305.4575">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="185" x="102" y="304.6011">[Continuous Sampling Cycle]</text><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="542.5" y1="330.6563" y2="330.6563"/><line style="stroke:#181818;stroke-width:1.0;" x1="542.5" x2="542.5" y1="330.6563" y2="343.6563"/><line style="stroke:#181818;stroke-width:1.0;" x1="501.5" x2="542.5" y1="343.6563" y2="343.6563"/><polygon fill="#181818" points="511.5,339.6563,501.5,343.6563,511.5,347.6563,507.5,343.6563" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="507.5" y="325.5903">Emit Red LED pulse (SpO2 channel)</text><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="542.5" y1="372.7891" y2="372.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="542.5" x2="542.5" y1="372.7891" y2="385.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="501.5" x2="542.5" y1="385.7891" y2="385.7891"/><polygon fill="#181818" points="511.5,381.7891,501.5,385.7891,511.5,389.7891,507.5,385.7891" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="507.5" y="367.7231">Measure reflected IR intensity</text><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="542.5" y1="414.9219" y2="414.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="542.5" x2="542.5" y1="414.9219" y2="427.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="501.5" x2="542.5" y1="427.9219" y2="427.9219"/><polygon fill="#181818" points="511.5,423.9219,501.5,427.9219,511.5,431.9219,507.5,427.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="507.5" y="409.856">Emit IR LED pulse (Heart Rate channel)</text><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="542.5" y1="457.0547" y2="457.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="542.5" x2="542.5" y1="457.0547" y2="470.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="501.5" x2="542.5" y1="470.0547" y2="470.0547"/><polygon fill="#181818" points="511.5,466.0547,501.5,470.0547,511.5,474.0547,507.5,470.0547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="507.5" y="451.9888">Measure reflected IR intensity</text><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="542.5" y1="499.1875" y2="499.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="542.5" x2="542.5" y1="499.1875" y2="512.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="501.5" x2="542.5" y1="512.1875" y2="512.1875"/><polygon fill="#181818" points="511.5,508.1875,501.5,512.1875,511.5,516.1875,507.5,512.1875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="507.5" y="494.1216">Store Red &amp; IR samples into FIFO</text><polygon fill="#181818" points="750.5,537.3203,760.5,541.3203,750.5,545.3203,754.5,541.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="500.5" x2="756.5" y1="541.3203" y2="541.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="507.5" y="536.2544">Pull INT low (Data Ready Interrupt)</text><polygon fill="#181818" points="60.5,566.4531,50.5,570.4531,60.5,574.4531,56.5,570.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54.5" x2="761.5" y1="570.4531" y2="570.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="66.5" y="565.3872">Trigger ISR (Interrupt Service Routine)</text><polygon fill="#181818" points="488.5,595.5859,498.5,599.5859,488.5,603.5859,492.5,599.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="49.5" x2="494.5" y1="599.5859" y2="599.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="56.5" y="594.52">Read FIFO data via I2C</text><line style="stroke:#181818;stroke-width:1.0;" x1="49.5" x2="91.5" y1="643.8516" y2="643.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="91.5" x2="91.5" y1="643.8516" y2="656.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="50.5" x2="91.5" y1="656.8516" y2="656.8516"/><polygon fill="#181818" points="60.5,652.8516,50.5,656.8516,60.5,660.8516,56.5,656.8516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="56.5" y="623.6528">Separate Red and IR samples</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="56.5" y="638.7856">(SpO2 vs Heart Rate)</text><polygon fill="#181818" points="488.5,681.9844,498.5,685.9844,488.5,689.9844,492.5,685.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="49.5" x2="494.5" y1="685.9844" y2="685.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="56.5" y="680.9185">Clear interrupt flag</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="853" x="0" y="721.5508"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="853" y1="721.5508" y2="721.5508"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="853" y1="724.5508" y2="724.5508"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="81" x="386" y="710.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="392" y="727.0513">Optional</text><polygon fill="#181818" points="488.5,776.3828,498.5,780.3828,488.5,784.3828,492.5,780.3828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="49.5" x2="494.5" y1="780.3828" y2="780.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="56.5" y="760.1841">Reconfigure parameters</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="56.5" y="775.3169">(e.g., sampling rate or LED power)</text><!--MD5=[330446aeadfd54f46bcfc459a78e566f]
@startuml
title Hardware Layer Sequence Diagram - ESP32 & MAX30102 (Asynchronous Dual Measurement)

participant "ESP32" as MCU
participant "MAX30102" as SENSOR
participant "Interrupt Line (INT)" as INT

== Initialization Phase ==
MCU -> SENSOR: Power ON & Initialize I2C
MCU -> SENSOR: Configure registers\n(set mode = SpO2 + HR, LED currents, sample rate, FIFO settings)
SENSOR -> SENSOR: Start internal sampling timer

== Asynchronous Measurement Loop ==
loop Continuous Sampling Cycle
    SENSOR -> SENSOR: Emit Red LED pulse (SpO2 channel)
    SENSOR -> SENSOR: Measure reflected IR intensity
    SENSOR -> SENSOR: Emit IR LED pulse (Heart Rate channel)
    SENSOR -> SENSOR: Measure reflected IR intensity
    SENSOR -> SENSOR: Store Red & IR samples into FIFO
    SENSOR -> INT: Pull INT low (Data Ready Interrupt)
    
    INT -> MCU: Trigger ISR (Interrupt Service Routine)
    MCU -> SENSOR: Read FIFO data via I2C
    MCU -> MCU: Separate Red and IR samples\n(SpO2 vs Heart Rate)
    MCU -> SENSOR: Clear interrupt flag
end

== Optional ==
MCU -> SENSOR: Reconfigure parameters\n(e.g., sampling rate or LED power)
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>